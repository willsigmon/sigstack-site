# BRAIN Debrief — 2025-12-12

## What’s now true (high level)
- **BRAIN = wsiglog + tower data + MCP + n8n**, with wsiglog as the shared truth for agents.
- **Codex boots cleanly** (fixed TOML duplicate key), and now has a **`wsiglog` MCP server**.
- **Daily journaling to Craft is already live** via n8n (see “Auto Journal” below).

## Fixes / changes applied

### Codex startup
- Removed the duplicate Vercel definition from `.codex/config.toml` (the JSON MCP config remains the source of truth).
- Re-added Vercel + wsiglog to `.codex/config.toml` in a non-conflicting way.
- Confirmed with `codex mcp list`:
  - `wsiglog` enabled
  - `vercel` enabled (needs OAuth login)

### Unified BRAIN MCP (no direct Omi/Limitless calls)
- `manusaisetup/wsiglog_mcp.py` now calls wsiglog HTTP only:
  - `/synthesize/:date`, `/conversations`, `/people`, `/patterns`, `/serendipity`, `/reflections`, `/stats`, `/notes`, `/health`

### Ingestion (incremental)
- `scripts/ingest_omi_to_wsiglog.py`
  - Pulls Omi conversations (requires `OMI_API_KEY`) and inserts into tower sqlite `wsiglog.db` with `source='omi'`.
- `scripts/ingest_limitless_to_wsiglog.py`
  - Batch POSTs local Limitless lifelogs to wsiglog `POST /ingest/limitless` (incremental state file).
- `scripts/ingest_persons_to_wsiglog.py`
  - Inserts local persons JSON into wsiglog `people` table on tower (incremental state file).
- `scripts/brain_auto_ingest.sh`
  - Runs Omi ingest → Limitless ingest → Persons ingest
  - Bootstraps entities/relations from people
  - Triggers daily summaries (today + yesterday)
  - Updates embeddings index

### Semantic layer (lightweight)
- `scripts/build_embeddings_index.py`
  - Computes embeddings via Ollama and stores them in a new `embeddings` table in `wsiglog.db` (incremental).
  - Uses `brain:latest` for embeddings by default (works on your current Ollama version).

### Entities/relations baseline
- `scripts/populate_entities_relations_from_people.py`
  - Populates `entities` from `people`
  - Adds `Will Sigmon --interacted_with--> <person>` relations

### LLM enrichment (optional)
- `scripts/extract_projects_entities_relations.py`
  - Optional enrichment to populate `projects`, `entities`, `relations`, `observations` using Ollama.
  - Only runs from `brain_auto_ingest.sh` when `ENABLE_LLM_ENRICH=1`.

### Serendipity n8n workflow (improved template)
- Added `brain/n8n-workflows/brain-serendipity-nudge-v2.json`
  - Fix: fetches `/conversations/:id` so transcripts + participants exist (the list endpoint doesn’t include them).
  - Uses env vars in n8n: `WSIGLOG_URL`, `OLLAMA_URL`, `NTFY_URL`.

## Auto Journal (Craft.do)
You already have an active workflow on tower:
- **n8n workflow:** `wsiglog Daily Ledger` (`lQ4cSakXgWIh08Iw`)
  - Runs daily at **6 AM**
  - Calls wsiglog `/synthesize/<yesterday>`
  - Formats into markdown (nice “Daily Ledger” format)
  - Posts to Craft via Craft Connect blocks API:
    - `https://connect.craft.do/links/HquFFKSHGEn/api/v1/blocks`
    - Inserts into `pageId: 5ae59b55-1423-4a6b-8665-64a1dd9fb3a1`

Also active:
- **n8n workflow:** `Weekly Master Aggregation` (`3WbYgrEQpzSdGduL`)
  - Weekly report → Craft (same link + pageId)

## Quick “when you wake up” checklist
1. Log Vercel MCP in once:
   - `codex mcp login vercel`
2. Set `OMI_API_KEY` so Omi ingest runs:
   - Create `~/.brain/brain.env` (copy from `.brain/brain.env.example`) and fill `OMI_API_KEY`.
3. Run:
   - `bash /Users/wsig/scripts/brain_doctor.sh`

## Next good ideas (highest leverage)
1. **Expose semantic search to agents**
   - Add a small MCP tool that reads `embeddings` + does cosine similarity locally, so “/search” becomes semantic for all agents (without changing wsiglog API).
2. **Serendipity nudges become “always-on”**
   - Wire Omi Conversation Processor → new-person detector → Brave search → nudge → (optional) create a Craft “Contact Brief” block.
3. **Auto “who did I just talk to?” when not home**
   - Use the existing `BRAIN Real-Time Location Receiver` + your iPhone location to only nudge when you’re away from home.
4. **Safety**
   - If you ever expose wsiglog outside LAN/Tailscale, add an API key header check.
