{
  "name": "wsiglog Backup 2 - Weekly PostgreSQL Dump",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 1
            }
          ]
        }
      },
      "name": "Weekly Sunday 3 AM",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [
        0,
        0
      ],
      "id": "667beb1f-c6be-43a5-999a-3a329375f77e"
    },
    {
      "parameters": {},
      "name": "Manual Test",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        0,
        200
      ],
      "id": "9e7f8c5e-2419-4895-bf90-b2af7830fb09"
    },
    {
      "parameters": {
        "command": "docker exec postgresql-n8n pg_dump -U n8n wsiglog > /mnt/user/data/wsiglog-backups/weekly/wsiglog-$(date +%Y-%m-%d).sql && gzip /mnt/user/data/wsiglog-backups/weekly/wsiglog-$(date +%Y-%m-%d).sql && echo 'Backup complete'",
        "authentication": "privateKey"
      },
      "name": "PostgreSQL Dump",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [
        300,
        100
      ],
      "credentials": {
        "sshPrivateKey": {
          "id": "tower-ssh",
          "name": "Tower SSH"
        }
      },
      "id": "096079cc-1c59-499a-a74e-4b38bdfe921e"
    },
    {
      "parameters": {
        "command": "ls -la /mnt/user/data/wsiglog-backups/weekly/ | tail -5",
        "authentication": "privateKey"
      },
      "name": "Verify Backup",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [
        550,
        100
      ],
      "credentials": {
        "sshPrivateKey": {
          "id": "tower-ssh",
          "name": "Tower SSH"
        }
      },
      "id": "1cbea9e2-dbd3-4308-b859-1be57fc7848c"
    },
    {
      "parameters": {
        "command": "find /mnt/user/data/wsiglog-backups/weekly -name '*.sql.gz' -mtime +30 -delete && echo 'Old backups cleaned'",
        "authentication": "privateKey"
      },
      "name": "Cleanup Old Backups",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [
        800,
        100
      ],
      "credentials": {
        "sshPrivateKey": {
          "id": "tower-ssh",
          "name": "Tower SSH"
        }
      },
      "id": "8b14ace8-18a2-4696-b080-762f6342fe90"
    }
  ],
  "connections": {
    "Weekly Sunday 3 AM": {
      "main": [
        [
          {
            "node": "PostgreSQL Dump",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Manual Test": {
      "main": [
        [
          {
            "node": "PostgreSQL Dump",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PostgreSQL Dump": {
      "main": [
        [
          {
            "node": "Verify Backup",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Verify Backup": {
      "main": [
        [
          {
            "node": "Cleanup Old Backups",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false
  },
  "staticData": {
    "node:Weekly Sunday 3 AM": {
      "recurrenceRules": []
    }
  }
}
