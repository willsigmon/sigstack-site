{
  "name": "Build & Deploy Monitor",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "build-status",
        "options": {}
      },
      "name": "Build Webhook",
      "type": "n8n-nodes-base.webhook",
      "position": [250, 300],
      "webhookId": "build-hook"
    },
    {
      "parameters": {
        "conditions": {
          "options": { "caseSensitive": true, "leftValue": "", "typeValidation": "strict" },
          "conditions": [
            { "leftValue": "={{ $json.body.status }}", "rightValue": "success", "operator": { "type": "string", "operation": "equals" } }
          ]
        }
      },
      "name": "Build Success?",
      "type": "n8n-nodes-base.if",
      "position": [450, 300]
    },
    {
      "parameters": {
        "webhookUri": "={{ $env.DISCORD_WEBHOOK_URL }}",
        "text": "‚úÖ **Build Successful**\n\nüì¶ **Project**: {{ $json.body.project || 'Leavn' }}\nüè∑Ô∏è **Version**: {{ $json.body.version || 'N/A' }}\n‚è±Ô∏è **Duration**: {{ $json.body.duration || 'N/A' }}\nüîó **Commit**: {{ $json.body.commit || 'N/A' }}",
        "options": {}
      },
      "name": "Discord Success Alert",
      "type": "n8n-nodes-base.discord",
      "position": [700, 200]
    },
    {
      "parameters": {
        "webhookUri": "={{ $env.DISCORD_WEBHOOK_URL }}",
        "text": "‚ùå **Build Failed**\n\nüì¶ **Project**: {{ $json.body.project || 'Leavn' }}\nüö® **Error**: {{ $json.body.error || 'Unknown' }}\nüîó **Commit**: {{ $json.body.commit || 'N/A' }}\nüìã **Logs**: {{ $json.body.log_url || 'N/A' }}",
        "options": {}
      },
      "name": "Discord Failure Alert",
      "type": "n8n-nodes-base.discord",
      "position": [700, 400]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $env.SUPABASE_URL }}/rest/v1/build_logs",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            { "name": "apikey", "value": "={{ $env.SUPABASE_ANON_KEY }}" },
            { "name": "Authorization", "value": "Bearer {{ $env.SUPABASE_ANON_KEY }}" },
            { "name": "Content-Type", "value": "application/json" },
            { "name": "Prefer", "value": "return=minimal" }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ { project: $json.body.project, version: $json.body.version, status: $json.body.status, error: $json.body.error, commit: $json.body.commit, duration: $json.body.duration, created_at: $now.toISO() } }}"
      },
      "name": "Log to Supabase",
      "type": "n8n-nodes-base.httpRequest",
      "position": [950, 300]
    }
  ],
  "connections": {
    "Build Webhook": { "main": [[{ "node": "Build Success?", "type": "main", "index": 0 }]] },
    "Build Success?": { "main": [[{ "node": "Discord Success Alert", "type": "main", "index": 0 }], [{ "node": "Discord Failure Alert", "type": "main", "index": 0 }]] },
    "Discord Success Alert": { "main": [[{ "node": "Log to Supabase", "type": "main", "index": 0 }]] },
    "Discord Failure Alert": { "main": [[{ "node": "Log to Supabase", "type": "main", "index": 0 }]] }
  },
  "settings": { "executionOrder": "v1" }
}
